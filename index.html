<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show de Luzes - Público</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { 
            margin: 0; 
            background: #000; 
            color: white; 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden; 
            transition: background 0.1s; 
        }
        #status { font-size: 12px; position: absolute; bottom: 20px; opacity: 0.5; }
        .btn-ready { 
            padding: 20px 40px; 
            background: #27ae60; 
            color: white; 
            border-radius: 50px; 
            font-weight: bold; 
            border: none; 
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

    <button id="readyBtn" class="btn-ready">ESTOU PRONTO PARA O SHOW</button>
    <div id="status">Desconectado do servidor</div>

    <script>
        let videoTrack = null;
        
        // --- COLOQUE O SEU LINK DO RENDER ABAIXO ---
        const socket = io('https://servidor-show-luzes.onrender.com/'); 

        const readyBtn = document.getElementById('readyBtn');
        const statusDiv = document.getElementById('status');

        // Monitorar conexão
        socket.on('connect', () => {
            statusDiv.innerText = "Conectado ao servidor. Aguardando autorização...";
        });

        readyBtn.onclick = async () => {
            try {
                // Solicita acesso à câmera para usar a lanterna
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                videoTrack = stream.getVideoTracks()[0];
                
                readyBtn.style.display = 'none';
                statusDiv.innerText = "Sincronizado! Aguarde o início do show.";
                statusDiv.style.opacity = "1";
            } catch (e) { 
                statusDiv.innerText = "Erro ao acessar lanterna. Verifique as permissões."; 
                console.error(e);
            }
        };

        // Escutando os comandos que você envia do Painel Admin
        socket.on('comando_show', (data) => {
            // data chega como { cor: '#ffffff', luz: true }
            
            // 1. Muda a cor da tela
            document.body.style.backgroundColor = data.cor;

            // 2. Controla a lanterna
            if (videoTrack) {
                const capabilities = videoTrack.getCapabilities();
                if (capabilities.torch) {
                    videoTrack.applyConstraints({ 
                        advanced: [{ torch: data.luz }] 
                    }).catch(err => console.error("Erro na lanterna:", err));
                }
            }
        });
    </script>
</body>
</html>
